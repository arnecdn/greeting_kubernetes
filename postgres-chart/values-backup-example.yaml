# Example values for postgres-chart with MinIO backup enabled
# This file demonstrates how to configure CNPG with backup to MinIO

cluster:
  name: postgres-greeting
  namespace: cnpg-system
  instances: 1

  storage:
    size: 1Gi
    storageClass: ""

  database:
    name: greeting_rust
    owner: greeting_rust

  image:
    catalog:
      major: 16

  postgresql:
    parameters:
      compute_query_id: "on"

  extensions:
    enabled: false

# Enable backup to MinIO
backup:
  enabled: true
  destinationPath: "s3://postgres-backups/greeting-cluster"
  endpointURL: "http://minio.cnpg-system.svc.cluster.local:9000"
  minioAccessKey: "rootuser"
  minioSecretKey: "rootpass123"
  s3Credentials:
    secretName: minio-credentials
    accessKeyId: ACCESS_KEY_ID
    secretAccessKey: SECRET_ACCESS_KEY
  wal:
    retention: "7d"
  data:
    retention: "30d"
    immediateCheckpoint: false
  retentionPolicy: "30d"
  # Uncomment to enable scheduled backups
  # schedule: "0 2 * * *"  # Daily at 2 AM

secret:
  name: postgres-greeting-secret
  username: greeting_rust
  password: greeting_rust

config:
  enabled: true
  name: postgres-greeting-config
  postgresql_conf: |
    shared_preload_libraries = 'pg_tracing'
    compute_query_id = on
  pg_hba_conf: |
    host all all 0.0.0.0/0 md5

service:
  enabled: true
  name: postgres-greeting-service
  type: ClusterIP
  port: 5432
  targetPort: 5432

imageCatalog:
  enabled: true
  name: postgresql
  images:
    - major: 16
      repository: docker.io/arnecdn/greeting-postgres
      tag: "0.16"

monitoring:
  enabled: true
  grafana_alloy:
    endpoint: "http://grafana-alloy.default.svc.cluster.local:4318/v1/traces"
    naptime: 2000

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 100m
    memory: 256Mi

labels: {}
annotations: {}
